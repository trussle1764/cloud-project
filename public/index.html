<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Analytics Dashboard (Live Data)</title>

  <!-- Bootstrap for quick layout and clean styling -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- Plotly library used to draw charts -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    /* Light background to keep the dashboard clean */
    body {
      background-color: #f5f6fa;
    }

    /* Slight rounding to make cards look nicer */
    .card {
      border-radius: 12px;
    }
  </style>
</head>

<body>
  <div class="container py-5">
    <h2 class="text-center mb-5">Analytics Dashboard (Live Data)</h2>

    <div class="row g-4">
      <!-- Monthly sales bar chart -->
      <div class="col-md-6">
        <div class="card p-4 shadow-sm">
          <h5 class="text-center mb-3">Monthly Sales</h5>
          <div id="barChart"></div>
        </div>
      </div>

      <!-- Traffic sources pie chart -->
      <div class="col-md-6">
        <div class="card p-4 shadow-sm">
          <h5 class="text-center mb-3">Traffic Sources</h5>
          <div id="pieChart"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /*
      Fetch monthly sales data from the REST API
      and display it as a bar chart using Plotly
    */
    fetch("/api/monthly-sales")
      .then(response => response.json())
      .then(data => {
        Plotly.newPlot(
          "barChart",
          [{
            x: data.map(item => item.month),
            y: data.map(item => item.sales),
            type: "bar",
            marker: {
              color: "#4e79a7"
            }
          }],
          {
            xaxis: {
              title: "Month",
              type: "category"
            },
            yaxis: {
              title: "Sales"
            },
            margin: { t: 30 }
          }
        );
      });

    /*
      Fetch traffic source data from the REST API
      and show the percentage distribution as a pie chart
    */
    fetch("/api/traffic-sources")
      .then(response => response.json())
      .then(data => {
        Plotly.newPlot(
          "pieChart",
          [{
            labels: data.map(item => item.source),
            values: data.map(item => item.percentage),
            type: "pie"
          }],
          {
            margin: { t: 30 }
          }
        );
      });
  </script>
</body>
</html>
